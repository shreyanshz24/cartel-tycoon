<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cartel Tycoon: Grand Strategy</title>
  <style>
    :root {
      --main-green: #00ff00;
      --main-red: #ff0000;
      --dark-bg: #0a0a0a;
      --card-bg: rgba(0, 20, 0, 0.7);
      --border-color: #003300;
      --player-color: #0077ff;
      --ai1-color: #ff7700;
      --ai2-color: #ff00ff;
      --ai3-color: #ffff00;
      --ai4-color: #ff0080;
      --ai5-color: #00ffff;
      --neutral-color: #555;
    }

    body { font-family: 'Courier New', monospace; background: var(--dark-bg); color: var(--main-green); margin:0; padding:0; overflow:hidden; }
    .container { display:none; padding:15px; max-width:1600px; margin:0 auto; text-align:left; }
    .header { display:flex; justify-content:space-between; align-items:center; padding-bottom:8px; margin-bottom:10px; }
    .header h1 { font-size:2rem; color:var(--main-red); text-shadow:0 0 15px var(--main-red); margin:0; }
    .top-stats-bar { display:flex; gap:20px; background:var(--card-bg); padding:5px 15px; border-radius:8px; border:1px solid var(--border-color); }
    main { display:grid; grid-template-columns:320px 1fr 320px; gap:15px; height:calc(100vh - 100px); }
    .card { background:var(--card-bg); padding:15px; border-radius:12px; box-shadow:0 0 12px rgba(0,255,0,0.4); border:1px solid var(--border-color); display:flex; flex-direction:column; }
    h2 { border-bottom:1px solid var(--main-green); padding-bottom:4px; margin:0 0 8px 0; font-size:1.2rem; }
    h3 { font-size:1rem; margin:10px 0 5px; border-bottom:1px solid var(--border-color); padding-bottom:3px; }
    p { font-size:0.9rem; line-height:1.5; margin:4px 0; }
    button { width:100%; padding:8px 10px; margin:4px 0; background:var(--main-red); color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:bold; transition:0.2s; font-size:0.9rem; }
    #map-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:5px; }
    .territory { height:60px; border:2px solid #333; display:flex; flex-direction:column; justify-content:center; align-items:center; cursor:pointer; }
    .player-controlled { background:rgba(0,120,255,0.3); }
    .ai-1-controlled { background:rgba(255,120,0,0.3); }
    .ai-2-controlled { background:rgba(255,0,255,0.3); }
    .ai-3-controlled { background:rgba(255,255,0,0.3); }
    .ai-4-controlled { background:rgba(255,0,128,0.3); }
    .ai-5-controlled { background:rgba(0,255,255,0.3); }
    .neutral-controlled { background:rgba(128,128,128,0.2); }
    #menu { display:flex; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); color:#f00; font-size:3rem; justify-content:center; align-items:center; flex-direction:column; z-index:1000; }
    #pauseBtn { width:100px; background-color:#ffae00; }
    #pauseOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:#ffae00; font-size:5rem; text-shadow:0 0 15px #ffae00; justify-content:center; align-items:center; z-index:999; cursor:pointer; }
  </style>
</head>
<body>
  <div id="menu">
    <h1>Cartel Tycoon</h1>
    <input type="text" id="playerName" placeholder="Enter Your Name" style="background:#000;border:1px solid #0f0;color:#0f0;padding:10px;text-align:center;font-family:'Courier New', monospace;margin:10px;">
    <div id="singlePlayerOptions">
      <label for="aiCount" style="font-size: 1.5rem; color: #0f0;">AI Opponents (1-5):</label>
      <input type="number" id="aiCount" value="3" min="1" max="5" style="background:#000;border:1px solid #0f0;color:#0f0;padding:10px;text-align:center;font-family:'Courier New', monospace;margin:10px;">
    </div>
    <button onclick="startGame('single')" style="width: 300px;">Single Player</button>
  </div>

  <div id="game" class="container">
    <header class="header">
      <h1>Cartel Tycoon</h1>
      <div class="top-stats-bar" id="top-stats"></div>
      <button id="pauseBtn" onclick="togglePause()">Pause</button>
    </header>
    <main>
      <div class="card" id="operations"></div>
      <div class="card" id="center-panel"></div>
      <div class="card" id="personnel-inventory"></div>
    </main>
  </div>

  <div id="notifications" style="position:fixed;top:20px;right:20px;width:300px;z-index:1001;font-weight:bold;text-align:right;"></div>
  <div id="gameOverScreen" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);color:#f00;font-size:3rem;justify-content:center;align-items:center;flex-direction:column;z-index:1000;">
    <h2 id="gameOverText"></h2><button onclick="restartGame()">Restart</button>
  </div>
  <div id="pauseOverlay" onclick="togglePause()">PAUSED</div>

  <script>
    let playerName = "";
    let gameData = {};
    let gameLoopInterval = null;
    let isPaused = false;
    let currentActiveTab = 'map-panel';
    let currentActiveSubTab = 'lieutenants-subpanel';
    let isAssigningLieutenant = -1;

    // Reset game data
    function resetGameData(aiCount=3) {
      gameData = {
        money:5000, whiteMoney:0, heat:0,
        inventory:{ weed:0, meth:0, coke:0, heroin:0, fentanyl:0, chemicals:0 },
        armsStock:{ handgun:0, smg:0, rifle:0 },
        labLevel:0, armsTier:0, currentDrug:"weed",
        personnel:{ producers:0, dealers:0, soldiers:0, spies:0 },
        lieutenants:[], personnelLoyalty:70, payrollDue:100,
        territories:[], aiPlayers:[],
        research:{
          logistics1:{name:'Faster Couriers',desc:'+10% Dealer efficiency.',cost:10000,time:60,progress:0,unlocked:false,requires:null},
          logistics2:{name:'Bulk Chemicals',desc:'Buy Chemicals in bulk.',cost:50000,time:120,progress:0,unlocked:false,requires:'logistics1'},
          military1:{name:'Body Armor',desc:'+10% Soldier defense.',cost:25000,time:90,progress:0,unlocked:false,requires:null},
          military2:{name:'Assault Rifles',desc:'+15% Soldier attack power.',cost:100000,time:180,progress:0,unlocked:false,requires:'military1'},
          laundering1:{name:'Shell Corps',desc:'Lieutenants take a smaller cut.',cost:75000,time:150,progress:0,unlocked:false,requires:null},
          automation:{name:'Automation',desc:'Auto-produce Weed without workers.',cost:20000,time:100,progress:0,unlocked:false,requires:null}
        },
        researchInProgress:null,
        victory:{domination:{current:0,required:15},economic:{current:0,required:20000000},status:'Ongoing'},
        gameOver:false
      };
      // Territories
      const territoryNames=["Docks","Warehouse District","Downtown","Suburbs","Projects","West Side","East Side","Market","Old Town","The Strip","Airport","Industrial Park","Southside","Northbridge","Chinatown"];
      for(let i=0;i<15;i++){ gameData.territories.push({id:i,name:territoryNames[i],owner:'Neutral',value:Math.floor(Math.random()*50)+10,soldiers:0,lieutenant:-1,business:null}); }
      gameData.territories[0].owner='Player'; gameData.territories[0].soldiers=1;
      // AIs
      const aiNames=["El Jefe","La Reina","The Ghost","The Butcher","El Jaguar"];
      for(let i=0;i<aiCount;i++){const aiId=`AI-${i+1}`; gameData.territories[i+1].owner=aiId; gameData.territories[i+1].soldiers=2; gameData.aiPlayers.push({id:aiId,name:aiNames[i],money:3000,powerLevel:1,relationship:0,spies:1});}
    }

    function startGame() {
      playerName=document.getElementById('playerName').value||"Player";
      document.getElementById('menu').style.display='none';
      document.getElementById('game').style.display='block';
      const aiCount=parseInt(document.getElementById('aiCount').value)||3;
      resetGameData(aiCount);
      isPaused=false;
      gameLoopInterval=setInterval(gameLoop,2000);
      updateUI();
    }

    function gameLoop(){
      if(isPaused||gameData.gameOver)return;
      if(gameData.heat>=200) triggerGameOver("BUSTED!");
      runProduction();
      updateResearch();
      updateUI();
    }

    function togglePause(){
      if(gameData.gameOver)return;
      isPaused=!isPaused;
      if(isPaused){ clearInterval(gameLoopInterval); document.getElementById('pauseBtn').textContent="Resume"; document.getElementById('pauseOverlay').style.display='flex'; }
      else { gameLoopInterval=setInterval(gameLoop,2000); document.getElementById('pauseBtn').textContent="Pause"; document.getElementById('pauseOverlay').style.display='none'; }
    }

    function restartGame(){
      clearInterval(gameLoopInterval);
      gameLoopInterval=null;
      document.getElementById('gameOverScreen').style.display='none';
      document.getElementById('menu').style.display='flex';
      document.getElementById('game').style.display='none';
    }

    // --- Production ---
    function runProduction(){
      if(gameData.research.automation.unlocked){ gameData.inventory.weed += 2; }
    }
    function manualProduceWeed(){ gameData.inventory.weed += 1; showNotification("Produced 1 unit of Weed."); }

    // --- Research ---
    function startResearch(id){
      const r=gameData.research[id];
      if(gameData.whiteMoney>=r.cost && !r.unlocked){
        gameData.whiteMoney-=r.cost;
        gameData.researchInProgress=id;
        r.progress=0;
      } else showNotification("Not enough clean money!");
    }
    function updateResearch(){
      if(!gameData.researchInProgress) return;
      const r=gameData.research[gameData.researchInProgress];
      r.progress++;
      if(r.progress>=r.time){ r.unlocked=true; gameData.researchInProgress=null; showNotification(`${r.name} Completed!`); }
    }

    // --- UI ---
    function updateUI(){
      document.getElementById('top-stats').innerHTML=`💰 $${Math.floor(gameData.money)} | 💵 $${Math.floor(gameData.whiteMoney)} | 🔥 ${Math.floor(gameData.heat)} | 🌿 Weed: ${gameData.inventory.weed}`;
      document.getElementById('operations').innerHTML=`<h2>Operations</h2><button onclick="manualProduceWeed()">Produce Weed</button>`;
      let mapHTML=`<h2>City Map</h2><div id="map-grid">`;
      const ownerColors={'Player':'player','AI-1':'ai-1','AI-2':'ai-2','AI-3':'ai-3','AI-4':'ai-4','AI-5':'ai-5','Neutral':'neutral'};
      gameData.territories.forEach(t=>{ mapHTML+=`<div class="territory ${ownerColors[t.owner]}-controlled"><span>${t.name}</span><span>⚔️ ${t.soldiers}</span></div>`; });
      mapHTML+=`</div>`;
      document.getElementById('center-panel').innerHTML=mapHTML;
      let researchHTML=`<h2>Research</h2>`;
      for(let id in gameData.research){
        const r=gameData.research[id];
        if(r.unlocked) researchHTML+=`<p>✅ ${r.name}</p>`;
        else if(gameData.researchInProgress===id) researchHTML+=`<p>⏳ ${r.name} (${Math.floor(r.progress/r.time*100)}%)</p>`;
        else researchHTML+=`<button onclick="startResearch('${id}')">${r.name} ($${r.cost})</button>`;
      }
      document.getElementById('personnel-inventory').innerHTML=researchHTML;
    }

    // --- Utils ---
    function triggerGameOver(msg){ gameData.gameOver=true; clearInterval(gameLoopInterval); document.getElementById('gameOverText').textContent=msg; document.getElementById('gameOverScreen').style.display='flex'; }
    function showNotification(msg,color="#0f0"){ const n=document.createElement("div"); n.textContent=msg; n.style.background=color; n.style.color="#000"; n.style.padding="5px"; n.style.marginTop="5px"; document.getElementById('notifications').appendChild(n); setTimeout(()=>n.remove(),4000); }
  </script>
</body>
</html>
